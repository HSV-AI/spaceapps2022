schema: '2.0'
stages:
  pdf_to_text:
    cmd: python src/spaceapps2022/pdf_to_text.py data/01_raw/pdfs data/03_primary/texts
    deps:
    - path: data/01_raw/pdfs
      md5: aea3adc4d698c9b7f93502cdcb39cba7.dir
      size: 7064665
      nfiles: 6
    - path: src/spaceapps2022/pdf_to_text.py
      md5: 9c44cd2cc820e4f97f44188cf2915b7f
      size: 2015
    outs:
    - path: data/03_primary/texts
      md5: 815c117af9c100ec1def42078852b9b5.dir
      size: 264666
      nfiles: 6
  text_to_parquet:
    cmd: python src/spaceapps2022/text_to_parquet.py data/01_raw/texts data/04_feature/text.parquet
    deps:
    - path: data/01_raw/texts
      hash: md5
      md5: 90ae160122b7cfe80bd87c8bebaa0363.dir
      size: 31861147
      nfiles: 508
    - path: src/spaceapps2022/text_to_parquet.py
      md5: a21def4a9c7a1542f41dd3f766068625
      size: 758
    outs:
    - path: data/04_feature/text.parquet
      hash: md5
      md5: 0826225a8a4fdc239b7371a568ea5d62
      size: 18137633
  parquet_to_embeddings:
    cmd: python src/spaceapps2022/parquet_to_embeddings.py data/04_feature/text.parquet
      data/05_model_input/embeddings.npy
    deps:
    - path: data/04_feature/text.parquet
      hash: md5
      md5: 0826225a8a4fdc239b7371a568ea5d62
      size: 18137633
    - path: src/spaceapps2022/parquet_to_embeddings.py
      md5: 73743818ea51c647ddbb09753c528b3c
      size: 441
    outs:
    - path: data/05_model_input/embeddings.npy
      hash: md5
      md5: 56ab9dcdfe14304a8bd348d5b91752a9
      size: 1560704
  get_data:
    cmd: python src/spaceapps2022/get_sti_data.py data/02_intermediate/data.csv 1000
    deps:
    - path: data/01_raw/ntrs-public-metadata.json
      hash: md5
      md5: 38d2c6866f4a5aa4be524d3980489568
      size: 1622987158
    - path: src/spaceapps2022/get_sti_data.py
      hash: md5
      md5: c1c5be3c5cbc35e3cb4f649639e81160
      size: 3055
    outs:
    - path: data/02_intermediate/data.csv
      hash: md5
      md5: 255469b28279946850473a056add8399
      size: 62528
  get_files:
    cmd: python src/spaceapps2022/get_sti_files.py data/02_intermediate/data.csv data/01_raw
    deps:
    - path: data/02_intermediate/data.csv
      hash: md5
      md5: 255469b28279946850473a056add8399
      size: 62528
    - path: src/spaceapps2022/get_sti_data.py
      hash: md5
      md5: c1c5be3c5cbc35e3cb4f649639e81160
      size: 3055
    outs:
    - path: data/01_raw/pdfs
      hash: md5
      md5: b44eb5773bba1328f6499425a4c9fc55.dir
      size: 2652111536
      nfiles: 508
    - path: data/01_raw/texts
      hash: md5
      md5: 90ae160122b7cfe80bd87c8bebaa0363.dir
      size: 31861147
      nfiles: 508
  meta_to_abstracts:
    cmd: python src/spaceapps2022/meta_to_abstracts.py data/01_raw/ntrs-public-metadata.json
      data/04_feature/abstracts.parquet
    deps:
    - path: data/01_raw/ntrs-public-metadata.json
      hash: md5
      md5: 38d2c6866f4a5aa4be524d3980489568
      size: 1622987158
    - path: src/spaceapps2022/meta_to_abstracts.py
      md5: b598e82f0435dcd87d103a214e44be95
      size: 1010
    outs:
    - path: data/04_feature/abstracts.parquet
      hash: md5
      md5: 0de9036a05a32c81949bb03257bcc304
      size: 270399724
  abstracts_to_embeddings:
    cmd: python src/spaceapps2022/abstracts_to_embeddings.py data/04_feature/abstracts.parquet
      data/05_model_input/abstract_embeddings.npy
    deps:
    - path: data/04_feature/abstracts.parquet
      hash: md5
      md5: 0de9036a05a32c81949bb03257bcc304
      size: 270399724
    - path: src/spaceapps2022/abstracts_to_embeddings.py
      hash: md5
      md5: 29e28cd3f3e98a63af57aadc9ceaa723
      size: 697
    outs:
    - path: data/05_model_input/abstract_embeddings.npy
      hash: md5
      md5: 89697e29e79704c639d3235061e61331
      size: 852890240
  parquet_to_topics:
    cmd: python src/spaceapps2022/parquet_to_topics.py data/04_feature/text.parquet
      data/05_model_input/bertopics.npy
    deps:
    - path: data/04_feature/text.parquet
      hash: md5
      md5: 0826225a8a4fdc239b7371a568ea5d62
      size: 18137633
    - path: src/spaceapps2022/parquet_to_topics.py
      hash: md5
      md5: 21e51a681ad0c7a7bf523df664716b77
      size: 976
  download_file:
    cmd: wget --directory-prefix=data/01_raw https://www.sti.nasa.gov/docs/ntrs-public-metadata.json.gz
      && gunzip data/01_raw/ntrs-public-metadata.json.gz
    outs:
    - path: data/01_raw/ntrs-public-metadata.json
      hash: md5
      md5: 38d2c6866f4a5aa4be524d3980489568
      size: 1622987158
